port: 25565
max_memory: 2048
minecraft_version: latest
user_jvm_args: ""

info:
  name: Minecraft Fabric
  container: amazoncorretto:21-alpine
  user: fabric
  working_dir: fabric

actions:
  adduser: |
    adduser -H -D fabric fabric
    chown -R fabric:fabric .

  install: |
    apk add jq
    echo "eula=true" > eula.txt
    echo -e "server-port=${port}\nquery.port=${port}" > server.properties
    mkdir mods

  update: |
    wget --output-document=fabric-installer.jar $(wget -qO - https://meta.fabricmc.net/v2/versions/installer | jq -r ".[0].url")
    if [ "${minecraft_version}" == "latest" ]; then
      java -Xmx${max_memory}M -jar fabric-installer.jar server -downloadMinecraft
    else
      java -Xmx${max_memory}M -jar fabric-installer.jar server -downloadMinecraft -snapshot -mcversion ${minecraft_version}
    fi
    
    rm -f fabric-installer.jar

  start: java -Xmx${max_memory}M &{user_jvm_args} -Dterminal.jline=false -Dterminal.ansi=true -Dlog4j2.formatMsgNoLookups=true -jar fabric-server-launch.jar nogui
  stop: stop
  backup:
    directory: .
    start: save-off
    finish: save-on