port: 25565
max_memory: 2048
minecraft_version: latest
user_jvm_args: ""

info:
  name: Minecraft Paper
  container: amazoncorretto:21-alpine
  user: paper
  working_dir: paper

actions:
  adduser: |
    adduser -H -D paper paper
    chown -R paper:paper .

  install: |
    apk add jq
    
    if [ "${minecraft_version}" == "latest" ]; then
      minecraft_version=$(wget -qO - https://api.papermc.io/v2/projects/paper/ | jq -r ".versions[-1]")
    fi
    
    build_version=$(wget -qO - https://api.papermc.io/v2/projects/paper/versions/${minecraft_version}/builds/ | jq -r ".builds[-1].build")
    wget --output-document=paper.jar https://api.papermc.io/v2/projects/paper/versions/${minecraft_version}/builds/${build_version}/downloads/paper-${minecraft_version}-${build_version}.jar
    
    touch eula.txt
    echo "eula=true" > eula.txt
    touch server.properties
    echo -e "server-port=${port}\nquery.port=${port}" > server.properties
    mkdir plugins

  start: java -Xmx${max_memory}M &{user_jvm_args} -Dterminal.jline=false -Dterminal.ansi=true -Djline.terminal=jline.UnsupportedTerminal -Dlog4j2.formatMsgNoLookups=true -jar paper.jar nogui
  stop: stop
  backup:
    directory: .
    start: save-off
    finish: save-on